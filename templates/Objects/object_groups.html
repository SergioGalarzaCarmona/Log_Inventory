{%load static%}
<!DOCTYPE html>
<html lang="es"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="{%static '/CSS/sideBarStyles.css'%}">
    <link rel="stylesheet" href="{%static '/CSS/GroupStyles.css'%}">
    {% if permissions == "Estudiante" %}
    <link rel="stylesheet" href="{%static '/CSS/sideBarSmallStyles.css'%}">
    {% endif %}
    <title>Grupos de Objetos - Log Inventory</title>
    <link rel="icon" href="{%static '/IMAGES/LogoMini.webp'%}" type="image/webp">
    <meta name="description" content="Grupos de Objetos Log Inventory">
    <meta name="author" content="Log Inventory">
    <meta name="robots" content="noindex, nofollow"> 
</head> 
<body>
    {% include 'sideBar.html' with path='main' profile=profile type=type permissions=permissions active_objects_groups="active"%}
    <main> 
        <div class="filter-bar container"> 
            <div class="filter-bar__filter-container row">
                <input type="submit" value="sort" class="filter-bar__a-z material-symbols-outlined col-md-1 col-0" title="Ordenar a-z">
                <input type="submit" value="sort" class="filter-bar__z-a material-symbols-outlined col-md-1 col-0" title="Ordenar z-a">
                <input type="submit" value="view_object_track" class="filter-bar__type material-symbols-outlined col-md-1 col-3" onclick="window.location.href='/work_space';" title="Gestionar Objetos">
                <div class="filter-bar__name col-md-4 col-8">
                    <input type="text" placeholder="Buscar por nombre..." id="search-input">
                    <input value="search" type="submit" class="material-symbols-outlined">
                </div>
                <div class="filter-bar__logo-container col-md-5 col-0">
                    <img src="{%static '/IMAGES/logo_transparente_blanco.webp'%}" alt="logo" class="logo">
                </div>
            </div>
        </div>
        <div class="forms-container">
            <nav>
                <label for="create-object" class="material-symbols-outlined close-formObject hidden">arrow_back</label>
                <label for="create-group" class="material-symbols-outlined close-formGroup hidden">arrow_back</label>
            </nav>
            <input type="checkbox" {{checked}} id="create-object">
            <form class="create-object" id='form-object' enctype="multipart/form-data" action="{% url 'main' %}" method="POST">
                {% csrf_token %}    
                <div>
                    {{ object_form.name.label_tag }}
                    {{ object_form.name }}
                    {% if object_form.errors.name %}
                        {{object_form.errors.name}}
                    {% endif %}
                </div>
            
                <div>
                    {{ object_form.stock.label_tag }}
                    {{ object_form.stock }}
                    {% if object_form.errors.stock %}
                        {{object_form.errors.stock}}
                    {% endif %}
                </div>
            
                <div>
                    {{ object_form.description.label_tag }}
                    {{ object_form.description }}
                </div>
            
                <div>
                    {{object_form.group.label_tag}}
                    <select name="group" required="" id="id_group">
                        <option value="" selected="">---------</option>
                        {% for group in groups %}
                        <option value="{{group.id}}" data-incharge="{{group.in_charge.id}}">{{group.name}}</option>
                        {% endfor %}
                    </select>
                    {% if object_form.errors.stock %}
                        {{object_form.errors.stock}}
                    {% endif %}
                </div>
            
                <div>
                    {{ object_form.in_charge.label_tag }}
                    {{ object_form.in_charge }}
                    {% if object_form.errors.in_charge %}
                        {{object_form.errors.in_charge}}
                    {% endif %}
                </div>
            
                <div>
                    {{ object_form.image.label_tag }}
                    {{ object_form.image }}
                </div>
                <input type="submit" value="Crear Objeto" id="create-button">
            </form>
            <input type="checkbox" {{checked_group}} id="create-group">
            <form class="create-group" method="POST" enctype="multipart/form-data" action="{% url 'main' %}">
                {% csrf_token %}
                {{object_group_form}}
                <input type="submit" value="Crear Grupo" id="create-group-button">
                <a id="link-button" hidden href="{% url 'manage_subusers' %}"></a>
            </form>
            <form action="{% url 'delete' %}" hidden id="delete-form" method="POST">{% csrf_token %}</form>
			<!-- Modal to create group if it ain't selected.-->
            <div id="createGroupModal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <h3 class="modal-title"></h3>
                    <p class="modal-text"></p>
                    <div class="modal-buttons">
                        <button id="cancelCreate" class="btn-cancel">No</button>
                        <button id="confirmCreate" class="btn-confirm">Si</button>
                    </div>
                </div>
            </div>
		    <!-- Delete confirmation modal -->
        	<div id="deleteModal" class="modal-overlay" style="display: none;">
            	<div class="modal-content">
            	    <h3>Est치s seguro?</h3>
            	    <p>Esto eliminar치 permanentemente el/los grupo/s seleccionado/s.</p>
            	    <div class="modal-buttons">
            	        <button id="cancelDelete" class="btn-cancel">Cancelar</button>
            	        <button id="confirmDelete" class="btn-delete">Borrar</button>
            	    </div>
            	</div>
        	</div>
        </div>  
        <div class="groups">
            <input type="checkbox" class="delete hidden" id="delete">
            {% for form in forms %}
            <div class="group-container">
                <div class="group-header">
                    <input name="object_group-{{form.instance.id}}" type="checkbox" class="delete-checkbox hidden" form="delete-form">
                    <span class="material-symbols-outlined toggle-icon">expand_more</span>
                    <h3 class="group-title">{{form.instance.name}}</h3>
                    <p class="group-in-charge">Encargado: {{form.instance.in_charge}}</p>
                </div>
                <div class="group-body">
                <form method="POST" class="group-image" enctype="multipart/form-data">
                    <label for="id_image_{{form.instance.id}}">
                        <img src="{{form.instance.image.url}}" alt="Group Image">
                        <div class="image-overlay">
                            <label class="delete-image material-symbols-outlined" for="delete_image_{{form.instance.id}}">delete</label>
                        </div>
                    </label>
                    {% csrf_token %} 
                    <input type="number" value="{{form.instance.id}}" hidden name="id">
                    <input type="file" name="image" class="image-input" accept="image/*" required="" id="id_image_{{form.instance.id}}" >
                    <input type="submit" id="id_submit_{{form.instance.id}}" hidden>
                </form>
                <form method="POST" id="{{form.instance.id}}_form" class="group-info"> 
                    {%csrf_token%}
                    <input type="number" value="{{form.instance.id}}" hidden name="id">
                    <div class="group-name__container username__container">
                        {{form.name.label_tag}}
                        {{form.name}}
                    </div>
                    <div class="group-in-charge__container">
                        {{form.in_charge.label_tag}}
                        {{form.in_charge}}
                    </div>
                </form>
                <div class="group-description__container">
                    <label for="id_description_{{form.instance.id}}">Descripci칩n:</label>
                    <textarea form="{{form.instance.id}}_form"  name="description" cols="40" rows="10" maxlength="1000" id="id_description_{{form.instance.id}}" placeholder="Descripci칩n del grupo">{{form.description.value}}</textarea>
                    <div>
                        {%if form.instance.pk == group.pk %}
                        {{form_post.errors.name}}
                        {%endif%}
                    </div>
                    <div>
                        {%if form.instance.pk == group.pk %}
                        {{form_post.errors.in_charge}}
                        {%endif%}
                    </div>
                </div>
                <form class="group-buttons" method="POST">
                    {% csrf_token %}
                    <input type="submit" value="delete" class="delete-button material-symbols-outlined" id="delete-button-{{form.instance.id}}" form="delete_group_{{form.instance.id}}">
                    <input type="submit" value="Guardar" class="save-button" form="{{form.instance.id}}_form">
                </form>
                <form method="POST">
                    {% csrf_token %}
                    <input type="number" value="{{form.instance.id}}" hidden name="id">
                    <input type="checkbox" name="delete_image" checked id="id_delete_checkbox_{{form.instance.id}}" hidden>
                    <input type="submit" id="delete_image_{{form.instance.id}}" value="submit" on_click="" hidden>
                </form>
                <form  class="hidden" id="delete_group_{{form.instance.id}}" method="POST">
                    {% csrf_token %}
                    <input type="number" value="{{form.instance.id}}" hidden name="id">
                    <input type="checkbox" name="delete_group" id="id_delete_group_{{form.instance.id}}" checked hidden>
                </form>
            </div>
        </div>
        {% endfor %}    
        </div>
        {% if messages %}
            <div class="messages-container">
                {% for message in messages %}
                    <div class="message-{{message.tags}}">
                        <div class="message-text">
                            {{ message }}
                        </div>
                        <div class="message-close-button" id="message-close-button" role="button" aria-label="Cerrar">
                            <span class="material-symbols-outlined message-close-button">Close</span>
                        </div>
                      </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </main>
    <script src="{% static '/SCRIPTS/sidebarScript.js'%}"></script>
    <script src="{% static '/SCRIPTS/objectGroupsScript.js' %}"></script>
    <script src="{% static '/SCRIPTS/deleteScript.js' %}"></script>
</body>
</html>