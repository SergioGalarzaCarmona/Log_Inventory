{% load i18n %}
{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="{%static '/CSS/sideBarStyles.css'%}">
    <link rel="stylesheet" href="{% static '/CSS/Objects/logStyles.css' %}">
    {% if permissions == "Estudiante" %}
    <link rel="stylesheet" href="{%static '/CSS/sideBarSmallStyles.css'%}">
    {% endif %}
    <title>Historial de Cambios - Log Inventory</title>
    <link rel="icon" href="{%static '/IMAGES/LogoMini.webp'%}" type="image/webp">
    <meta name="description" content="Historial Log Inventory">
    <meta name="author" content="Log Inventory">
    <meta name="robots" content="noindex, nofollow">
</head>
<body>
   {% include 'sideBar.html' with path='log' profile=profile type=type permissions=permissions active_log="active" %}
    <main> 
        <div class="filter-bar container"> 
            <div class="filter-bar__filter-container row">
              <div class="filter-bar__buttons col-md-4 col-12">
                    {% if permissions != "Estudiante" %}
                    <div title="Historial de Usuarios" class="material-symbols-outlined col-md-1 col-3"><label for="subusersLog" id="subusersLog-label">manage_accounts</label></div>
                    <div title="Historial de Grupos de Usuarios" class="material-symbols-outlined col-md-1 col-3"><label for="subusersgroupsLog" id="subusersgroupsLog-label">groups</label></div>
                    {% endif %}
                    <div title="Historial de Objetos" class="material-symbols-outlined col-md-1 col-3"><label id="objectsLog-label">view_object_track</label></div>
                    <div title="Historial de Grupos de Objetos" class="material-symbols-outlined col-md-1 col-3"><label id="objectgroupsLog-label">stack</label></div>
                </div>
                <div class='filter-bar__name col-md-4 col-0'>
                    <input type="text" placeholder="Buscar objeto por nombre..." id="search-input">
                    <input value="search" type="submit" class="material-symbols-outlined">
                </div>
                <div class='filter-bar__logo-container col-md-4 col-0'>
                    <img src="{%static '/IMAGES/logo_transparente_blanco.webp'%}" alt="logo" class="logo">
                </div> 
            </div> 
        </div>
        <div class="form-container">
          <nav>
            <label for="export-log" class="material-symbols-outlined close-export-log">arrow_back</label>
          </nav>
          <input type="checkbox" id="export-log" class="filter-bar__checkbox">
          <form method="POST" class="export-log-form">
            {% csrf_token %}
            {{ export_form }} 
            <div>
              <label for="type_export">Exportar historial de:</label>
              <select name="type_export" id="type_export">
                <option value="users">Usuarios</option>
                <option value="user_groups">Grupos de Usuarios</option>
                <option value="objects">Objetos</option>
                <option value="object_groups">Grupos de Objetos</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">Exportar Historial</button>
          </form>
        </div>
        <div class="logs-container">


        {% if permissions != "Estudiante" %}
          <!-- SUBUSERS LOG -->
        <input type="checkbox" id="subusersLog" class="filter-bar__checkbox">
        <div class="history-container subusersLog"> 
          <div class="history-title">
            <span class="material-symbols-outlined">event_note</span> Historial de Usuarios
          </div>
          <div class="timeline">
            {% for log in log_users %}
            <div class="timeline-entry">
              <div class="entry-time">{{ log.date|time:"H:i" }}, {{log.date |date:"SHORT_DATE_FORMAT"}}</div>
              <div class="entry-user data_changed">{{log.user_changed.first_name}} {{log.user_changed.last_name}}</div> <span class="entry-changer"> Cambio hecho por {{log.user}}</span>
              <div class="entry-description">
                {% trans log.description %}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- SUBUSERGROUPS LOG -->
        <input type="checkbox" id="subusersgroupsLog" class="filter-bar__checkbox">
        <div class="history-container subusersgroupsLog hidden">
          <div class="history-title">
            <span class="material-symbols-outlined">event_note</span> Historial de Grupos de Usuarios
          </div>
          <div class="timeline">
            {% for log in log_user_groups %}
            <div class="timeline-entry">
              <div class="entry-time">{{ log.date|time:"H:i" }}, {{log.date |date:"SHORT_DATE_FORMAT"}}</div>
              <div class="entry-group data_changed">{{log.group_changed.name}}</div> <span class="entry-changer"> Cambio hecho por {{log.user}}</span>
              <div class="entry-description">
                {% trans log.description %}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        <!-- OBJECTS LOG -->
        <input type="checkbox" id="objectsLog" class="filter-bar__checkbox">
        <div class="history-container objectsLog {% if permissions != 'Estudiante' %} hidden {% endif %}">
          <div class="history-title">
            <span class="material-symbols-outlined">event_note</span> Historial de Objetos
          </div>
          <div class="timeline">
            {% for log in log_objects %}
            <div class="timeline-entry">
              <div class="entry-time">{{ log.date|time:"H:i" }}, {{log.date |date:"SHORT_DATE_FORMAT"}}</div>
              <div class="entry-object data_changed">{{log.object.name}}</div> <span class="entry-changer"> Cambio hecho por {{log.in_charge}}</span>
              <div class="entry-description">
                {% trans log.description %}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- OBJECTGROUPS LOG -->
        <input type="checkbox" id="objectGroupsLog" class="filter-bar__checkbox">
        <div class="history-container objectgroupsLog hidden">
          <div class="history-title">
            <span class="material-symbols-outlined">event_note</span> Historial de Grupos de Objetos
          </div>
          <div class="timeline">
            {% for log in log_object_groups %}
            <div class="timeline-entry">
              <div class="entry-time">{{ log.date|time:"H:i" }}, {{log.date |date:"SHORT_DATE_FORMAT"}}</div>
              <div class="entry-object-group data_changed">{{log.group_changed.name}} </div><span class="entry-changer"> Cambio hecho por {{log.user}}</span>
              <div class="entry-description">
                {% trans log.description %}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        </div>
    </main>

    {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
                <div class="message-{{message.tags}}">
                    <div class="message-text">
                        {{ message }}
                    </div>
                    <div class="message-close-button" id="message-close-button" role="button" aria-label="Cerrar">
                        <span class="material-symbols-outlined message-close-button">Close</span>
                    </div>
                  </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <script src="{%static '/SCRIPTS/sidebarScript.js'%}"></script>
    <script src="{% static 'SCRIPTS/logScript.js' %}"></script>
</body>
</html>