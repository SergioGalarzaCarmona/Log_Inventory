{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="{%static '/CSS/sideBarStyles.css'%}">
    <link rel="stylesheet" href="{%static '/CSS/Users/subprofilesGroupStyles.css'%}">
    <link rel="stylesheet" href="{%static '/CSS/Users/subusersStyles.css'%}">
    <title>Manejo de Grupos - Log Inventory</title>
    <link rel="icon" href="{%static '/IMAGES/LogoMini.webp'%}" type="image/webp">
    <meta name="description" content="Subusers Groups Log Inventory">
    <meta name="author" content="Log Inventory">
    <meta name="robots" content="noindex, nofollow">
</head>
<body>
    {% include 'sideBar.html' with path='manage_subusergroups' profile=profile type=type permissions=permissions active_subusers="active"%}
    <main>
        <div class="filter-bar container"> 
            <div class="filter-bar__filter-container row">
                <input type="submit" value="sort" class="filter-bar__a-z material-symbols-outlined col-md-1 col-0">
                <input type="submit" value="sort" class="filter-bar__z-a material-symbols-outlined col-md-1 col-0">
                <input onclick="window.location.href='/manage_subusers';" type="submit" value="filter_alt" class="filter-bar__type material-symbols-outlined col-md-1 col-3">
                <div class="filter-bar__name col-md-4 col-8">
                    <input type="text" class="filter-bar__search">
                    <input value="search" type="submit" class="material-symbols-outlined">
                </div>
                <div class="filter-bar__logo-container col-md-5 col-0">
                    <img src="{%static '/IMAGES/logo_transparente_blanco.webp'%}" alt="logo" class="logo">
                </div>
            </div>
        </div>
        <div class="forms-container">
            <nav>
                <label for="create-subuser" class="material-symbols-outlined close-formSubuser hidden">arrow_back</label>
                <label for="create-group" class="material-symbols-outlined close-formGroup hidden">arrow_back</label>
            </nav>
            <input type="checkbox" {{checked}} id="create-subuser">
            <form class="create-subuser" id='form-subuser' action="{% url 'manage_subusers' %}" enctype="multipart/form-data" method="POST">
                {% csrf_token %}    
                {{subuser_form}}
                <input type="button" value="Crear Usuario" id="open-dialog">
                <input type="submit" hidden id="submit">
            </form>
            <input type="checkbox" {{checked_group}} id="create-group">
            <form class="create-group" method="POST" action="{% url 'manage_subusers' %}" enctype="multipart/form-data">
                {% csrf_token %}
                {{group_form}}
                <input type="submit" value="Crear Grupo">
            </form>
            <dialog id="group-dialog">
                <label for="close-dialog" class="material-symbols-outlined">Close</label>
                <p>Para poder crear un usuario necesita un grupo primero, ¿Desea crear un grupo?</p>
                <div> 
                    <button value=0 id="close-dialog">No</button>
                    <button value=1 id="create">Si</button>
                </div>
            </dialog>
        </div>
        <div class="groups">
        {% for form in forms %}
        <div class="group-container">
            <form method="POST" class="group-image" enctype="multipart/form-data">
                <label for="id_image_{{form.instance.id}}">
                    <img src="{{form.instance.image.url}}" alt="Group Image">
                    <div class="image-overlay">
                        <label class="delete-image material-symbols-outlined" for="delete_image_{{form.instance.id}}">delete</label>
                    </div>
                </label>
                {% csrf_token %} 
                <input type="number" value="{{form.instance.id}}" hidden name="id">
                <div>
                    <label for="id_image_{{form.instance.id}}" >Imagen de Perfil:</label>
                    <input type="file" name="image" class="" accept="image/*" required="" id="id_image_{{form.instance.id}}" >
                </div>
                <input type="submit" id="id_submit_{{form.instance.id}}" hidden>
            </form>
            <form method="POST" id="{{form.instance.id}}_form" class="group-info"> 
                {%csrf_token%}
                <input type="number" value="{{form.instance.id}}" hidden name="id">
                <div class="group-name__container username__container">
                    <label for="id_name">Nombre:</label>
                    {{form.name}}
                </div>
                <div class="group-permissions__container">
                    <label for="id_permissions">Tipo de grupo:</label>
                    {{form.permissions}}
                </div>
                
                <input type="submit" value="delete" class="delete-button material-symbols-outlined" form="delete_group_{{form.instance.id}}">
                <input type="submit" value="Guardar" class="save-button">
            </form>
            <div class="group-description__container">
                <label for="id_description_{{form.instance.id}}">Descripción:</label>
                <textarea form="{{form.instance.id}}_form"  name="description" cols="40" rows="10" maxlength="1000" id="id_description_{{form.instance.id}}" placeholder="Descripción del grupo">{{form.description.value}}</textarea>
                <div>
                    {%if form.instance.pk == group.pk %}
                    {{form_post.errors.name}}
                    {%endif%}
                </div>
                <div>
                    {%if form.instance.pk == group.pk %}
                    {{form_post.errors.permissions}}
                    {%endif%}
                </div>
                <div>
                    {%if form.instance.pk == group.pk %}
                    {{form_post.errors.description}}
                    {%endif%}
                </div>
            </div>
            <form method="POST">
                {% csrf_token %}
                <input type="number" value="{{form.instance.id}}" hidden name="id">
                <input type="checkbox" name="delete_image" checked id="id_delete_checkbox_{{form.instance.id}}" hidden>
                <input type="submit" id="delete_image_{{form.instance.id}}" value="submit" on_click="" hidden>
            </form>
            <form  class="hidden" id="delete_group_{{form.instance.id}}" method="POST">
                {% csrf_token %}
                <input type="number" value="{{form.instance.id}}" hidden name="id">
                <input type="checkbox" name="delete_group" id="id_delete_group_{{form.instance.id}}" checked hidden>
            </form>
        </div>
        {% endfor %}
        </div>
    </main>
    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="message-{{message.tags}}">
            <div class="message-text">
                {{ message }}
            </div>
            <div class="message-close-button" id="message-close-button" role="button" aria-label="Cerrar">
                <span class="material-symbols-outlined message-close-button">Close</span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <script src="{%static '/SCRIPTS/subusersGroupScript.js'%}"></script>
    <script src="{%static '/SCRIPTS/sidebarScript.js'%}"></script>
</body>
</html>